---
on:
    push:
        paths:
          - directory.json
    pull_request:
        branches:
          - master
        paths:
          - directory.json
    workflow_dispatch:

jobs:
    jsonlint:
        name: Lint JSON
        runs-on: ubuntu-latest
        steps:
        - run: sudo apt-get install -y python3-demjson
        - uses: actions/checkout@v2
        - run: jsonlint --strict ./directory.json
    check-url:
        name: Check URL
        runs-on: ubuntu-latest
        steps:
          - name: Checkout repository
            uses: actions/checkout@v2
            with:
              fetch-depth: 2
          - name: Get changed urls from directory.json
            id: changes
            run: |
              echo "::set-output name=urls::$(\
                git \
                  diff \
                  --diff-filter=ACMRT \
                  --minimal \
                  --rotate-to directory.json \
                  ${{ github.event.pull_request.base.sha }} \
                  ${{ github.sha }} \
                | grep ^+ \
                | tail -n -1 \
                | grep -Eo 'https?://[^"]+')"
